<!-- pages/schedule/calendar/index.wxml -->
<view class="calendar-page">
  <!-- æœˆä»½å¯¼èˆªæ  -->
  <view class="month-nav">
    <view class="nav-btn prev" bindtap="prevMonth">â€¹</view>
    <view class="current-month">{{currentYear}}å¹´{{currentMonth + 1}}æœˆ</view>
    <view class="nav-btn next" bindtap="nextMonth">â€º</view>
  </view>

  <!-- æ˜ŸæœŸæ ‡é¢˜ -->
  <view class="week-header">
    <view wx:for="{{weekDays}}" wx:key="index" class="week-day">{{item}}</view>
  </view>

  <!-- æ—¥å†ç½‘æ ¼ -->
  <view class="calendar-grid">
    <view 
      wx:for="{{calendarDays}}" 
      wx:key="index"
      class="day-cell {{item.isToday ? 'today' : ''}} {{item.isCurrentMonth ? '' : 'other-month'}} {{item.hasSchedule ? 'has-schedule' : ''}}"
      data-date="{{item.date}}"
      bindtap="onDayClick"
    >
      <view class="day-number">{{item.day}}</view>
      <view wx:if="{{item.hasSchedule}}" class="schedule-dots">
        <view wx:for="{{item.scheduleCount > 3 ? 3 : item.scheduleCount}}" wx:key="index" class="dot"></view>
        <view wx:if="{{item.scheduleCount > 3}}" class="more-count">+{{item.scheduleCount - 3}}</view>
      </view>
    </view>
  </view>

  <!-- æ—¥ç¨‹ç±»å‹ç­›é€‰ -->
  <scroll-view scroll-x class="type-filter">
    <view class="filter-list">
      <view 
        wx:for="{{scheduleTypes}}" 
        wx:key="id"
        class="filter-item {{activeType === item.id ? 'active' : ''}}"
        data-type="{{item.id}}"
        bindtap="onTypeFilter"
      >
        <view class="filter-icon">{{item.icon}}</view>
        <view class="filter-text">{{item.name}}</view>
      </view>
    </view>
  </scroll-view>

  <!-- é€‰ä¸­çš„æ—¥æœŸå’Œæ—¥ç¨‹ -->
  <view class="selected-date-section">
    <view class="section-title">
      <text>{{selectedDateStr}}</text>
      <view class="add-btn" bindtap="onAddSchedule">
        <text class="add-icon">+</text>
        <text>æ·»åŠ æ—¥ç¨‹</text>
      </view>
    </view>
    
    <!-- æ—¥ç¨‹åˆ—è¡¨ -->
    <view wx:if="{{selectedDaySchedules.length > 0}}">
      <view class="schedule-list">
        <view 
          wx:for="{{selectedDaySchedules}}" 
          wx:key="id" 
          class="schedule-item"
          data-id="{{item.id}}"
          bindtap="onScheduleItemClick"
        >
          <view class="schedule-time">
            <view class="time-range">{{formatTimeRange(item.startTime, item.endTime)}}</view>
            <view class="duration">{{getDuration(item.startTime, item.endTime)}}åˆ†é’Ÿ</view>
          </view>
          <view class="schedule-detail">
            <view class="schedule-title">{{item.title}}</view>
            <view class="schedule-meta">
              <view class="schedule-type" style="color: {{item.color || '#1890ff'}};">
                {{getScheduleTypeText(item.scheduleType)}}
              </view>
              <view class="location">ğŸ“ {{item.location || 'æœªè®¾ç½®åœ°ç‚¹'}}</view>
            </view>
            <view class="schedule-participants">
              <text wx:if="{{item.clientName}}" class="client-tag">{{item.clientName}}</text>
            </view>
          </view>
          <view class="schedule-status {{getStatusClass(item.status)}}">
            {{getStatusText(item.status)}}
          </view>
        </view>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <image src="../../../static/images/empty/calendar.png" class="empty-icon" />
      <view class="empty-text">è¿™ä¸€å¤©æ²¡æœ‰å®‰æ’</view>
      <view class="empty-subtext">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ æ—¥ç¨‹</view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="fab-container">
    <view class="fab-button" bindtap="onAddSchedule">
      <text class="fab-icon">+</text>
    </view>
  </view>
</view>