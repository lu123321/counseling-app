<!-- pages/client/list/index.wxml -->
<view class="client-list-page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-container">
      <image src="../../../static/icons/search.png" class="search-icon" />
      <input 
        type="text" 
        class="search-input" 
        placeholder="æœç´¢æ¥è®¿è€…å§“åæˆ–æ ‡ç­¾" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view wx:if="{{searchKeyword}}" class="clear-btn" bindtap="clearSearch">âœ•</view>
    </view>
    <view class="filter-btn" bindtap="onFilterClick">
      <image src="../../../static/icons/filter.png" class="filter-icon" />
      <text wx:if="{{activeFilter !== 'all'}}" class="filter-badge"></text>
    </view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <scroll-view scroll-x class="status-filter">
    <view class="filter-list">
      <view 
        wx:for="{{statusFilters}}" 
        wx:key="value"
        class="status-item {{activeFilter === item.value ? 'active' : ''}}"
        data-value="{{item.value}}"
        bindtap="onStatusFilter"
      >
        <view class="status-text">{{item.label}}</view>
        <view wx:if="{{item.count > 0}}" class="status-count">{{item.count}}</view>
      </view>
    </view>
  </scroll-view>

  <!-- æ¥è®¿è€…åˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="client-scroll" 
    bindscrolltolower="onScrollToLower"
    refresher-enabled="{{true}}"
    bindrefresherrefresh="onRefresh"
    refresher-triggered="{{refreshing}}"
  >
    <!-- åˆ—è¡¨å¤´éƒ¨ä¿¡æ¯ -->
    <view class="list-header">
      <view class="total-count">
        å…±{{totalCount}}ä½æ¥è®¿è€…
      </view>
      <view class="sort-options">
        <view 
          class="sort-option {{sortField === 'create_time' ? 'active' : ''}}" 
          data-field="create_time"
          bindtap="onSortChange"
        >
          æœ€è¿‘æ·»åŠ 
        </view>
        <view 
          class="sort-option {{sortField === 'last_session' ? 'active' : ''}}" 
          data-field="last_session"
          bindtap="onSortChange"
        >
          æœ€è¿‘å’¨è¯¢
        </view>
      </view>
    </view>

    <!-- æ¥è®¿è€…åˆ—è¡¨ -->
    <view wx:if="{{clients.length > 0}}">
      <view class="client-list">
        <view 
          wx:for="{{clients}}" 
          wx:key="id" 
          class="client-item"
          data-id="{{item.id}}"
          bindtap="onClientItemClick"
        >
          <view class="client-avatar">
            <text class="avatar-text">{{item.name.charAt(0)}}</text>
            <view wx:if="{{item.gender === 1}}" class="gender-badge male">â™‚</view>
            <view wx:if="{{item.gender === 2}}" class="gender-badge female">â™€</view>
          </view>
          <view class="client-info">
            <view class="client-name-row">
              <view class="client-name">{{item.name}}</view>
              <view class="client-status status-{{item.status}}">
                {{getStatusText(item.status)}}
              </view>
            </view>
            <view class="client-meta">
              <text wx:if="{{item.age}}" class="meta-item">ğŸ‘¤ {{item.age}}å²</text>
              <text class="meta-item">ğŸ“ {{item.contactPhone || 'æœªè®¾ç½®'}}</text>
            </view>
            <view class="client-tags">
              <text 
                wx:for="{{item.tags || []}}" 
                wx:key="index" 
                class="tag"
              >
                #{{item}}
              </text>
            </view>
            <view class="client-session-info">
              <text class="session-count">ğŸ¯ {{item.sessionCount || 0}}æ¬¡å’¨è¯¢</text>
              <text class="last-session">ğŸ• {{formatLastSession(item.lastSessionTime)}}</text>
            </view>
          </view>
          <view class="client-actions">
            <view class="action-btn more" catchtap="onMoreAction" data-id="{{item.id}}">
              â‹®
            </view>
          </view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loadingMore}}" class="load-more">
        <text>åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && clients.length > 0}}" class="load-more">
        <text>æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <image src="../../../static/images/empty/empty.png" class="empty-icon" />
      <view class="empty-text">
        {{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³æ¥è®¿è€…' : 'æš‚æ— æ¥è®¿è€…'}}
      </view>
      <view class="empty-subtext">
        {{searchKeyword ? 'æ¢ä¸ªå…³é”®è¯è¯•è¯•' : 'æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä½æ¥è®¿è€…å¼€å§‹è®°å½•'}}
      </view>
      <view wx:if="{{!searchKeyword}}" class="empty-action" bindtap="onAddClient">
        æ·»åŠ æ¥è®¿è€…
      </view>
      <view wx:else class="empty-action" bindtap="clearSearch">
        æ¸…ç©ºæœç´¢
      </view>
    </view>
  </scroll-view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="fab-container">
    <view class="fab-button" bindtap="onAddClient">
      <text class="fab-icon">+</text>
    </view>
  </view>

  <!-- æ“ä½œèœå• -->
  <view wx:if="{{showActionMenu}}" class="action-menu-mask" bindtap="closeActionMenu">
    <view class="action-menu">
      <view class="menu-item" bindtap="onEditClient" data-id="{{selectedClientId}}">
        <image src="/images/icons/edit.png" class="menu-icon" />
        <text>ç¼–è¾‘ä¿¡æ¯</text>
      </view>
      <view class="menu-item" bindtap="onAddSession" data-id="{{selectedClientId}}">
        <image src="/images/icons/add.png" class="menu-icon" />
        <text>è®°å½•å’¨è¯¢</text>
      </view>
      <view class="menu-item" bindtap="onViewSessions" data-id="{{selectedClientId}}">
        <image src="/images/icons/history.png" class="menu-icon" />
        <text>æŸ¥çœ‹å’¨è¯¢å†å²</text>
      </view>
      <view class="menu-item danger" bindtap="onDeleteClient" data-id="{{selectedClientId}}">
        <image src="/images/icons/delete.png" class="menu-icon" />
        <text>åˆ é™¤æ¥è®¿è€…</text>
      </view>
    </view>
  </view>
</view>