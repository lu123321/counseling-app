<!-- pages/client/select/index.wxml -->
<view class="client-select-page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-container">
      <view class="search-icon">ğŸ”</view>
      <input 
        type="text" 
        class="search-input" 
        placeholder="æœç´¢æ¥è®¿è€…å§“åæˆ–æ ‡ç­¾" 
        value="{{searchKeyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <view wx:if="{{searchKeyword}}" class="clear-btn" catchtap="clearSearch">Ã—</view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <scroll-view scroll-x class="quick-scroll">
      <view class="quick-list">
        <view class="quick-item" bindtap="onAddClient">
          <view class="quick-icon">+</view>
          <view class="quick-text">æ–°å»ºæ¥è®¿è€…</view>
        </view>
        <view 
          wx:for="{{quickFilters}}" 
          wx:key="value"
          class="quick-item {{activeFilter === item.value ? 'active' : ''}}"
          data-value="{{item.value}}"
          bindtap="onQuickFilter"
        >
          <view class="quick-icon">{{item.icon}}</view>
          <view class="quick-text">{{item.text}}</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¥è®¿è€…åˆ—è¡¨ -->
  <scroll-view 
    scroll-y 
    class="client-scroll" 
    bindscrolltolower="onScrollToLower"
    refresher-enabled="{{true}}"
    bindrefresherrefresh="onRefresh"
    refresher-triggered="{{refreshing}}"
  >
    <!-- åˆ—è¡¨å¤´éƒ¨ -->
    <view class="list-header">
      <view class="total-count">
        å…±{{totalCount}}ä½æ¥è®¿è€…
        <text wx:if="{{selectedCount > 0}}" class="selected-count">ï¼ˆå·²é€‰{{selectedCount}}ä½ï¼‰</text>
      </view>
    </view>

    <!-- æ¥è®¿è€…åˆ—è¡¨ -->
    <view wx:if="{{clients.length > 0}}">
      <view class="client-list">
        <view 
          wx:for="{{clients}}" 
          wx:key="id" 
          class="client-item"
          data-id="{{item.id}}"
          catchtap="onClientSelect"
        >
          <!-- é€‰æ‹©æ¡† -->
          <view class="select-checkbox">
            <view class="checkbox {{selectedClients[item.id] ? 'checked' : ''}}">
              <view wx:if="{{selectedClients[item.id]}}" class="checkbox-inner"></view>
            </view>
          </view>
          
          <!-- æ¥è®¿è€…ä¿¡æ¯ -->
          <view class="client-info">
            <view class="client-header">
              <view class="client-avatar">
                <text class="avatar-text">{{item.name.charAt(0)}}</text>
              </view>
              <view class="client-main">
                <view class="client-name">{{item.name}}</view>
                <view class="client-status status-{{item.status}}">
                  {{getStatusText(item.status)}}
                </view>
              </view>
            </view>
            
            <view class="client-details">
              <view class="client-meta">
                <text wx:if="{{item.age}}" class="meta-item">ğŸ‘¤ {{item.age}}å²</text>
                <text class="meta-item">ğŸ“ {{item.contactPhone || 'æœªè®¾ç½®'}}</text>
              </view>
              
              <view class="client-tags">
                <text 
                  wx:for="{{item.tags || []}}" 
                  wx:key="index" 
                  class="tag"
                >
                  #{{item}}
                </text>
              </view>
              
              <view class="client-session-info">
                <text class="session-count">ğŸ¯ {{item.sessionCount || 0}}æ¬¡å’¨è¯¢</text>
                <text class="last-session">ğŸ• {{formatLastSession(item.lastSessionTime)}}</text>
              </view>
            </view>
          </view>
          
          <!-- è¯¦æƒ…ç®­å¤´ -->
          <view class="detail-arrow">â€º</view>
        </view>
      </view>
      
      <!-- åŠ è½½æ›´å¤š -->
      <view wx:if="{{loadingMore}}" class="load-more">
        <text>åŠ è½½ä¸­...</text>
      </view>
      <view wx:if="{{!hasMore && clients.length > 0}}" class="load-more">
        <text>æ²¡æœ‰æ›´å¤šäº†</text>
      </view>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <view class="empty-text">
        {{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³æ¥è®¿è€…' : 'æš‚æ— æ¥è®¿è€…'}}
      </view>
      <view class="empty-subtext">
        {{searchKeyword ? 'æ¢ä¸ªå…³é”®è¯è¯•è¯•' : 'æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä½æ¥è®¿è€…å¼€å§‹è®°å½•'}}
      </view>
      <view class="empty-action" bindtap="onAddClient">
        æ·»åŠ æ¥è®¿è€…
      </view>
    </view>
  </scroll-view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view wx:if="{{selectedCount > 0}}" class="action-bar">
    <view class="selected-info">
      <text class="selected-text">å·²é€‰ {{selectedCount}} ä½æ¥è®¿è€…</text>
    </view>
    <view class="action-buttons">
      <view class="cancel-btn" catchtap="onClearSelection">æ¸…ç©º</view>
      <view class="confirm-btn" catchtap="onConfirmSelection">ç¡®å®šé€‰æ‹©</view>
    </view>
  </view>
</view>