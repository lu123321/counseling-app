<!-- pages/client/detail/index.wxml -->
<view class="client-detail-page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <view class="back-btn" bindtap="onBack">â€¹</view>
    <view class="header-title">æ¥è®¿è€…è¯¦æƒ…</view>
    <view class="header-actions">
      <view class="action-btn" bindtap="onEditClient">ç¼–è¾‘</view>
    </view>
  </view>

  <!-- æ¥è®¿è€…åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
  <view class="client-info-card">
    <view class="info-header">
      <view class="client-avatar">
        <text class="avatar-text">{{clientInfo.name ? clientInfo.name.charAt(0) : '?'}}</text>
        <view class="avatar-status status-{{clientInfo.status}}"></view>
      </view>
      <view class="client-basic">
        <view class="client-name-row">
          <view class="client-name">{{clientInfo.name || 'æœªå‘½å'}}</view>
          <view class="client-status status-{{clientInfo.status}}">
            {{getStatusText(clientInfo.status)}}
          </view>
        </view>
        <view class="client-meta">
          <text wx:if="{{clientInfo.gender}}" class="meta-item">
            {{clientInfo.gender === 1 ? 'ç”·' : clientInfo.gender === 2 ? 'å¥³' : 'æœªçŸ¥'}}
          </text>
          <text wx:if="{{clientInfo.age}}" class="meta-item">{{clientInfo.age}}å²</text>
          <text class="meta-item">ç¼–å·: {{clientInfo.clientNo || 'æš‚æ— '}}</text>
        </view>
      </view>
    </view>

    <!-- è”ç³»ä¿¡æ¯ -->
    <view class="contact-info">
      <view wx:if="{{clientInfo.contactPhone}}" class="contact-item">
        <view class="contact-icon">ğŸ“±</view>
        <view class="contact-detail">
          <view class="contact-label">è”ç³»ç”µè¯</view>
          <view class="contact-value">{{clientInfo.contactPhone}}</view>
        </view>
      </view>
      
      <view wx:if="{{clientInfo.emergencyContact}}" class="contact-item">
        <view class="contact-icon">ğŸš¨</view>
        <view class="contact-detail">
          <view class="contact-label">ç´§æ€¥è”ç³»äºº</view>
          <view class="contact-value">{{clientInfo.emergencyContact}} {{clientInfo.emergencyPhone}}</view>
        </view>
      </view>
    </view>

    <!-- æ ‡ç­¾ -->
    <view wx:if="{{clientInfo.tags && clientInfo.tags.length > 0}}" class="tags-section">
      <view class="section-label">æ ‡ç­¾</view>
      <view class="tags-list">
        <text wx:for="{{clientInfo.tags}}" wx:key="index" class="tag">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- å’¨è¯¢ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-header">
      <view class="stats-title">å’¨è¯¢ç»Ÿè®¡</view>
      <view class="stats-period">æ€»è®¡</view>
    </view>
    
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">{{clientInfo.sessionCount || 0}}</view>
        <view class="stat-label">å’¨è¯¢æ¬¡æ•°</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{formatMoney(clientInfo.totalFee || 0)}}</view>
        <view class="stat-label">ç´¯è®¡è´¹ç”¨</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-value">{{clientInfo.firstSession ? formatDate(clientInfo.firstSession, 'MM-dd') : 'æ— '}}</view>
        <view class="stat-label">é¦–æ¬¡å’¨è¯¢</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-value">{{clientInfo.lastSession ? formatDate(clientInfo.lastSession, 'MM-dd') : 'æ— '}}</view>
        <view class="stat-label">æœ€è¿‘å’¨è¯¢</view>
      </view>
    </view>
  </view>

  <!-- å’¨è¯¢è®°å½• -->
  <view class="section-container">
    <view class="section-header">
      <view class="section-title">å’¨è¯¢è®°å½•</view>
      <view class="section-action" bindtap="onAddSession">+ è®°å½•å’¨è¯¢</view>
    </view>
    
    <view wx:if="{{sessions.length > 0}}">
      <view class="session-list">
        <view 
          wx:for="{{sessions}}" 
          wx:key="id" 
          class="session-item"
          data-id="{{item.id}}"
          bindtap="onViewSession"
        >
          <view class="session-date">
            <view class="date-day">{{formatDay(item.sessionTime)}}</view>
            <view class="date-month">{{formatMonth(item.sessionTime)}}</view>
          </view>
          
          <view class="session-info">
            <view class="session-main">
              <view class="session-time">{{formatTime(item.sessionTime)}} {{item.duration || 50}}åˆ†é’Ÿ</view>
              <view class="session-type {{item.sessionType === 4 ? 'supervision' : ''}}">
                {{getSessionTypeText(item.sessionType)}}
                <text wx:if="{{item.sessionType === 4}}" class="supervision-tag">ç£å¯¼</text>
              </view>
            </view>
            
            <view class="session-meta">
              <text class="meta-item">Â¥{{formatMoney(item.fee)}}</text>
              <text class="meta-item">{{item.sessionMode === 1 ? 'é¢å¯¹é¢' : item.sessionMode === 2 ? 'è§†é¢‘' : 'ç”µè¯'}}</text>
              <text wx:if="{{item.location}}" class="meta-item">ğŸ“ {{item.location}}</text>
            </view>
            
            <view wx:if="{{item.contentSummary}}" class="session-summary">
              {{item.contentSummary}}
            </view>
            
            <view wx:if="{{item.tags && item.tags.length > 0}}" class="session-tags">
              <text wx:for="{{item.tags}}" wx:key="index" class="tag mini">{{item}}</text>
            </view>
          </view>
          
          <view class="session-status status-{{item.status}}">
            {{getSessionStatusText(item.status)}}
          </view>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-sessions">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">æš‚æ— å’¨è¯¢è®°å½•</view>
      <view class="empty-subtext">è®°å½•ç¬¬ä¸€æ¬¡å’¨è¯¢ï¼Œå¼€å§‹è·Ÿè¸ªè¿›å±•</view>
      <view class="empty-action" bindtap="onAddSession">è®°å½•å’¨è¯¢</view>
    </view>
  </view>

  <!-- å¤‡æ³¨ä¿¡æ¯ -->
  <view wx:if="{{clientInfo.remark}}" class="section-container">
    <view class="section-header">
      <view class="section-title">å¤‡æ³¨ä¿¡æ¯</view>
    </view>
    
    <view class="remark-card">
      <view class="remark-content">
        {{clientInfo.remark}}
      </view>
      <view class="remark-footer">
        <text class="remark-time">åˆ›å»ºæ—¶é—´: {{formatDate(clientInfo.createTime)}}</text>
      </view>
    </view>
  </view>

  <!-- è¯Šæ–­ä¸æ–¹æ¡ˆ -->
  <view wx:if="{{clientInfo.diagnosis || clientInfo.treatmentPlan}}" class="section-container">
    <view class="section-header">
      <view class="section-title">è¯Šæ–­ä¸æ–¹æ¡ˆ</view>
    </view>
    
    <view wx:if="{{clientInfo.diagnosis}}" class="clinical-section">
      <view class="clinical-label">åˆæ­¥è¯Šæ–­</view>
      <view class="clinical-content">{{clientInfo.diagnosis}}</view>
    </view>
    
    <view wx:if="{{clientInfo.treatmentPlan}}" class="clinical-section">
      <view class="clinical-label">æ²»ç–—æ–¹æ¡ˆ</view>
      <view class="clinical-content">{{clientInfo.treatmentPlan}}</view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®æ  -->
  <view class="action-bar">
    <view class="action-grid">
      <view class="action-item" bindtap="onAddSession">
        <view class="action-icon">ğŸ“</view>
        <view class="action-text">è®°å½•å’¨è¯¢</view>
      </view>
      
      <view class="action-item" bindtap="onViewAllSessions">
        <view class="action-icon">ğŸ“Š</view>
        <view class="action-text">å’¨è¯¢å†å²</view>
      </view>
      
      <view class="action-item" bindtap="onClientEdit">
        <view class="action-icon">âœï¸</view>
        <view class="action-text">ç¼–è¾‘ä¿¡æ¯</view>
      </view>
      
      <view class="action-item" bindtap="onMoreActions">
        <view class="action-icon">â‹¯</view>
        <view class="action-text">æ›´å¤š</view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
  <view class="safe-area"></view>

  <!-- æ“ä½œèœå• -->
  <view wx:if="{{showActionMenu}}" class="action-menu-mask" catchtap="closeActionMenu">
    <view class="action-menu">
      <view class="menu-item" bindtap="onExportData">
        <view class="menu-icon">ğŸ“¤</view>
        <view class="menu-text">å¯¼å‡ºæ•°æ®</view>
      </view>
      
      <view class="menu-item" bindtap="onChangeStatus">
        <view class="menu-icon">ğŸ”„</view>
        <view class="menu-text">{{clientInfo.status === 1 ? 'ç»“æŸå’¨è¯¢' : 'é‡æ–°å¼€å§‹'}}</view>
      </view>
      
      <view class="menu-item" bindtap="onTransferClient">
        <view class="menu-icon">ğŸ”„</view>
        <view class="menu-text">è½¬ä»‹</view>
      </view>
      
      <view class="menu-item danger" bindtap="onDeleteClient">
        <view class="menu-icon">ğŸ—‘ï¸</view>
        <view class="menu-text">åˆ é™¤æ¥è®¿è€…</view>
      </view>
    </view>
  </view>
</view>