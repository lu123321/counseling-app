<!-- pages/index/index.wxml -->
<view class="index-page">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar">
    <view class="date">{{currentDate}}</view>
    <view class="weather">â˜€ï¸ æ™´</view>
  </view>

  <!-- ç”¨æˆ·æ¬¢è¿åŒº -->
  <view class="welcome-section">
    <view class="user-info">
      <view class="avatar-emoji" wx:if="{{!userInfo.avatar}}">ğŸ‘¨â€âš•ï¸</view>
      <image class="avatar" wx:else src="{{userInfo.avatar}}" mode="aspectFill" />
      <view class="user-detail">
        <view class="greeting">{{greeting}}ï¼Œ{{userInfo.realName || userInfo.nickname || 'å’¨è¯¢å¸ˆ'}}</view>
        <view class="qualification">{{userInfo.qualification || 'å¿ƒç†å’¨è¯¢å¸ˆ'}}</view>
      </view>
    </view>
    <view class="notification" bindtap="onNotificationClick">
      <view class="notification-icon">ğŸ””</view>
      <view wx:if="{{unreadCount > 0}}" class="badge">{{unreadCount}}</view>
    </view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stat-item" bindtap="onTodayScheduleClick">
        <view class="stat-value">{{statistics.todayScheduleCount || 0}}</view>
        <view class="stat-label">ä»Šæ—¥æ—¥ç¨‹</view>
      </view>
      <view class="divider"></view>
      <view class="stat-item" bindtap="onMonthSessionClick">
        <view class="stat-value">{{statistics.monthSessionCount || 0}}</view>
        <view class="stat-label">æœ¬æœˆå’¨è¯¢</view>
      </view>
      <view class="divider"></view>
      <view class="stat-item" bindtap="onFinanceClick">
        <view class="stat-value">Â¥{{statistics.monthIncome || 0}}</view>
        <view class="stat-label">æœ¬æœˆæ”¶å…¥</view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="quick-actions">
    <view class="section-title">
      <text>å¿«æ·æ“ä½œ</text>
      <view class="more" bindtap="onMoreActions">æ›´å¤š</view>
    </view>
    <view class="action-grid">
      <view class="action-item" bindtap="onQuickRecord">
        <view class="action-icon record">ğŸ“</view>
        <view class="action-text">è®°å½•å’¨è¯¢</view>
      </view>
      <view class="action-item" bindtap="onAddClient">
        <view class="action-icon client">ğŸ‘¥</view>
        <view class="action-text">æ·»åŠ æ¥è®¿è€…</view>
      </view>
      <view class="action-item" bindtap="onAddSchedule">
        <view class="action-icon schedule">ğŸ“…</view>
        <view class="action-text">æ·»åŠ æ—¥ç¨‹</view>
      </view>
      <view class="action-item" bindtap="onQuickAccounting">
        <view class="action-icon finance">ğŸ’°</view>
        <view class="action-text">å¿«é€Ÿè®°è´¦</view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ—¥ç¨‹ -->
  <view class="today-schedule">
    <view class="section-title">
      <text>ä»Šæ—¥æ—¥ç¨‹</text>
      <view class="more" bindtap="onViewAllSchedule">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    
    <view wx:if="{{todaySchedules.length > 0}}">
      <view class="schedule-list">
        <view 
          wx:for="{{todaySchedules}}" 
          wx:key="id" 
          class="schedule-item"
          data-id="{{item.id}}"
          bindtap="onScheduleItemClick"
        >
          <view class="schedule-time">
            <view class="time">{{formatTime(item.startTime)}}</view>
            <view class="duration">{{getDuration(item.startTime, item.endTime)}}åˆ†é’Ÿ</view>
          </view>
          <view class="schedule-detail">
            <view class="schedule-title">{{item.title}}</view>
            <view class="schedule-meta">
              <view class="location">ğŸ“ {{item.location || 'æœªè®¾ç½®åœ°ç‚¹'}}</view>
              <view class="status {{getStatusClass(item.status)}}">{{getStatusText(item.status)}}</view>
            </view>
          </view>
          <view class="schedule-arrow">â€º</view>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“…</view>
      <view class="empty-text">ä»Šå¤©æ²¡æœ‰æ—¥ç¨‹å®‰æ’</view>
      <view class="empty-subtext">å¥½å¥½ä¼‘æ¯ï¼Œæˆ–è€…æ·»åŠ ä¸€äº›æ—¥ç¨‹å§</view>
      <view class="empty-action" bindtap="onAddSchedule">æ·»åŠ æ—¥ç¨‹</view>
    </view>
  </view>

  <!-- æœ€è¿‘æ¥è®¿è€… -->
  <view class="recent-clients">
    <view class="section-title">
      <text>æœ€è¿‘æ¥è®¿è€…</text>
      <view class="more" bindtap="onViewAllClients">æŸ¥çœ‹å…¨éƒ¨</view>
    </view>
    
    <view wx:if="{{recentClients.length > 0}}">
      <scroll-view scroll-x class="client-scroll">
        <view class="client-list">
          <view 
            wx:for="{{recentClients}}" 
            wx:key="id" 
            class="client-card"
            data-id="{{item.id}}"
            bindtap="onClientCardClick"
          >
            <view class="client-avatar">
              <text class="avatar-text">{{item.name.charAt(0)}}</text>
            </view>
            <view class="client-info">
              <view class="client-name">{{item.name}}</view>
              <view class="client-meta">
                <text>{{item.gender === 1 ? 'ç”·' : item.gender === 2 ? 'å¥³' : 'æœªçŸ¥'}}</text>
                <text> {{item.age}}å²</text>
              </view>
              <view class="client-tags">
                <text 
                  wx:for="{{item.tags || []}}" 
                  wx:key="index" 
                  class="tag"
                >
                  {{item}}
                </text>
              </view>
            </view>
            <view class="client-sessions">
              <text class="session-count">{{item.sessionCount || 0}}æ¬¡å’¨è¯¢</text>
              <text class="session-time">{{formatRelativeTime(item.lastSessionTime)}}</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
    
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¥</view>
      <view class="empty-text">æš‚æ— æ¥è®¿è€…</view>
      <view class="empty-subtext">æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä½æ¥è®¿è€…å¼€å§‹è®°å½•</view>
      <view class="empty-action" bindtap="onAddClient">æ·»åŠ æ¥è®¿è€…</view>
    </view>
  </view>

  <!-- è®¢é˜…æé†’ -->
  <view wx:if="{{!subscriptionStatus}}" class="subscription-reminder">
    <view class="reminder-content">
      <view class="reminder-icon">ğŸ‘‘</view>
      <view class="reminder-text">
        <view class="reminder-title">è§£é”å®Œæ•´åŠŸèƒ½</view>
        <view class="reminder-desc">å‡çº§ä¸“ä¸šç‰ˆï¼Œäº«å—æ— é™åˆ¶åŠŸèƒ½</view>
      </view>
      <view class="reminder-action" bindtap="onUpgradeClick">ç«‹å³å‡çº§</view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>